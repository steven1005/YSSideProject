<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡æ“¬çŒœæ‹³éŠæˆ²</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding-top: 50px;
        }

        .choices button {
            margin: 5px;
        }

        #gameResult {
            margin-top: 20px;
            font-size: 1.2em;
            font-weight: bold;
        }

        .loading {
            color: blue;
            font-style: italic;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1 class="mb-4 text-center">æ¨¡æ“¬çŒœæ‹³éŠæˆ²</h1>

        <div class="text-center mb-4">
            <h3>è«‹é¸æ“‡æ‚¨çš„å‡ºæ‹³ï¼š</h3>
            <div class="choices">
                <button id="btnRock" class="btn btn-outline-dark">çŸ³é ­</button>
                <button id="btnPaper" class="btn btn-outline-dark">å¸ƒ</button>
                <button id="btnScissors" class="btn btn-outline-dark">å‰ªåˆ€</button>
            </div>
        </div>

        <div class="text-center">
            <p>æ‚¨çš„é¸æ“‡ï¼š<strong id="userChoiceDisplay"></strong></p>
            <p>é›»è…¦é¸æ“‡ï¼š<strong id="computerChoiceDisplay"></strong></p>
        </div>

        <div id="gameResult" class="text-center"></div>
        <div id="loadingIndicator" class="loading text-center mt-3"></div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        $(document).ready(function () {
            const choices = ['çŸ³é ­', 'å¸ƒ', 'å‰ªåˆ€'];

            function determineWinner(user, computer) {
                if (user === computer) return "å¹³å±€ï¼";
                if (
                    (user === 'çŸ³é ­' && computer === 'å‰ªåˆ€') ||
                    (user === 'å¸ƒ' && computer === 'çŸ³é ­') ||
                    (user === 'å‰ªåˆ€' && computer === 'å¸ƒ')
                ) {
                    return "ä½ è´äº†ï¼ğŸ‰";
                } else {
                    return "é›»è…¦è´äº†ï¼ğŸ˜­";
                }
            }

            $('.choices button').on('click', function () {
                var userChoice = $(this).text();
                $('#userChoiceDisplay').text(userChoice);
                $('#computerChoiceDisplay').text('...'); // æ¸…ç©ºé›»è…¦é¸æ“‡ï¼Œé¡¯ç¤ºè¼‰å…¥ä¸­
                $('#gameResult').text(''); // æ¸…ç©ºä¸Šæ¬¡çµæœ
                $('#loadingIndicator').text('é›»è…¦æ­£åœ¨å‡ºæ‹³...');

                // æ¨¡æ“¬ Ajax è«‹æ±‚
                $.ajax({
                    url: '#', // æ¨¡æ“¬ä¼ºæœå™¨
                    type: 'POST',
                    data: { user_choice: userChoice },
                    dataType: 'json',
                    timeout: 100, // 3ç§’è¶…æ™‚

                    success: function (response) {
                        $('#computerChoiceDisplay').text(response.computer_choice);
                        $('#gameResult').text(response.result).removeClass().addClass('text-center font-weight-bold alert alert-' + (response.result.includes("è´äº†") ? 'success' : response.result.includes("å¹³å±€") ? 'secondary' : 'danger'));
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        $('#gameResult').text('éŠæˆ²å‡ºéŒ¯ï¼š' + textStatus).addClass('alert alert-danger');
                        $('#computerChoiceDisplay').text('éŒ¯èª¤');
                        console.error("Ajax Error: ", textStatus, errorThrown);
                    },
                    complete: function () {
                        $('#loadingIndicator').text(''); // éš±è—è¼‰å…¥æŒ‡ç¤ºå™¨
                    }
                });

                // --- æ¨¡æ“¬ä¼ºæœå™¨å›æ‡‰ ---
                setTimeout(function () {
                    var randomIndex = Math.floor(Math.random() * choices.length);
                    var computerChoice = choices[randomIndex];
                    var result = determineWinner(userChoice, computerChoice);

                    var mockResponse = {
                        computer_choice: computerChoice,
                        result: result
                    };
                    // è§¸ç™¼è‡ªè¨‚äº‹ä»¶æ¨¡æ“¬æˆåŠŸ
                    $('#btnRock').trigger('gameSuccess', [mockResponse]); // è§¸ç™¼ä»»ä¸€å€‹æŒ‰éˆ•çš„äº‹ä»¶
                }, 50); // å»¶é² 1 ç§’

                // ç¶å®šè‡ªè¨‚çš„ gameSuccess äº‹ä»¶
                $(document).on('gameSuccess', function (event, mockData) {
                    if (mockData) {
                        $('#computerChoiceDisplay').text(mockData.computer_choice);
                        $('#gameResult').text(mockData.result).removeClass().addClass('text-center font-weight-bold alert alert-' + (mockData.result.includes("è´äº†") ? 'success' : mockData.result.includes("å¹³å±€") ? 'secondary' : 'danger'));
                    } else {
                        $('#gameResult').text('æ¨¡æ“¬ä¼ºæœå™¨éŒ¯èª¤').addClass('alert alert-danger');
                    }
                    $('#loadingIndicator').text(''); // éš±è—è¼‰å…¥æŒ‡ç¤ºå™¨
                });
            });
        });
    </script>
</body>

</html>